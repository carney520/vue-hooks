{"version":3,"file":null,"sources":["../src/util.js","../src/procedure.js","../src/action.js","../src/plugin.js","../src/index.js"],"sourcesContent":["/**\n* 首字母大写\n*/\nexport function upperFirst (string) {\n  if (string.length > 1) {\n    return string.slice(0, 1).toUpperCase()  + string.slice(1)\n  } else {\n    return string\n  }\n}\n\n/**\n* 输出警告信息\n*/\nexport function warn(debug, message) {\n  if (debug) {\n    console.warn(message)\n    console.trace && console.trace()\n  }\n}\n\nexport function pick (obj, ...keys) {\n  let result = {}\n  if (obj == null) return result\n\n  keys.forEach(key => {\n    result[key] = obj[key]\n  })\n\n  return result\n}\n\n/**\n * thanks lodash\n */\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = Function.prototype.toString;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Used to resolve the [`toStringTag`](http://ecma-international.org/ecma-262/6.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar getPrototypeOf = Object.getPrototypeOf;\n\nexport function isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\nexport function isPlainObject(value) {\n  if (!isObjectLike(value) ||\n      objectToString.call(value) != objectTag || isHostObject(value)) {\n    return false;\n  }\n  var proto = getPrototypeOf(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n","let uid = 0\n\n// 使用 process 对象来维护hooks之间的数据交互，以及action的状态\nexport default class Procedure {\n  constructor (state) {\n    this.uid = uid++\n    this.state = state\n    this.locals = {}\n    this.stack = []\n  }\n\n  setState (state) {\n    this.state = state\n    return this\n  }\n\n  getState () {\n    return this.state\n  }\n\n  _push (value) {\n    this.stack.push(value)\n    return this\n  }\n\n  _pop () {\n    return this.stack.pop()\n  }\n\n  _peek () {\n    return this.stack[this.stack.length - 1]\n  }\n\n  // local state\n  set (name, value) {\n    this.locals[name] = value\n    return this\n  }\n\n  get (name) {\n    return this.locals[name]\n  } \n\n  destroy () {\n    this.locals = null\n    this.stack = null\n  }\n}","import { upperFirst } from './util.js'\nimport Procedure from './procedure.js'\n\n// TODO \n// debug\n// 支持promise\n// Procedure 对象回收\n// 观察者模式\n// 异常捕获加强\n// 流程跳转，skip, 回退\nexport default class Action {\n  constructor (name, context, debug) {\n    this.name = name\n    this.context = context\n    this.debug = debug\n    this.hooks = []\n    this._beforeEachListener = []\n    this._afterEachListener = []\n    return this\n  }\n\n  define (beforeHook, afterHook) {\n    let beforeFn, afterFn\n    if (typeof beforeHook === 'string' && afterHook === undefined) {\n      let name = upperFirst(beforeHook)\n      beforeFn = Action.resolveHook('before' + name, this.context)\n      afterFn = Action.resolveHook('after' + name, this.context)\n    } else {\n      beforeFn = (typeof beforeHook === 'function' && beforeHook) ||\n        (typeof beforeHook === 'string' && Action.resolveHook(beforeHook, this.context))\n\n      afterFn = (typeof afterHook === 'function' && afterHook) ||\n        (typeof afterHook === 'string' && Action.resolveHook(afterHook, this.context))\n    }\n\n    this.hooks.push({\n      beforeFn,\n      afterFn\n    })\n\n    return this\n  }\n\n  do (method) {\n    let persistMethod = (typeof method === 'function' && method) || this.context[method]\n    this.persistMethod = Action.persistMethodWrapper(persistMethod, this.context)\n    return this\n  }\n\n  runQueue (initPayload, runner, complete) {\n    let queue = this.hooks\n    const { NORMAL, ERROR, ABORTED, POST } = Action.STATE\n    let state = NORMAL\n    let proc = new Procedure(NORMAL)\n    proc._push(initPayload)\n    if (queue.length === 0) return done()\n\n    let done = () => {\n      complete(proc)\n      proc.destroy()\n    }\n\n    let step = (index) => {\n      const procState = proc.getState()\n      if (index < 0) {\n        // done\n        return done()\n      } else if (state === NORMAL && procState === NORMAL && index >= queue.length) {\n        return runner(this.persistMethod, proc, () => {\n          // 进入收尾阶段\n          state = POST\n          proc.setState(POST)\n          step(queue.length - 1)\n        })\n      }\n\n      if (procState === ABORTED) {\n        // aborted\n        proc.setState(ABORTED)\n        return done()\n      } else if (procState === ERROR && state === NORMAL) {\n        // error\n        state = ERROR\n        index -= 1\n      }\n\n      if (state === NORMAL) {\n        runner(queue[index].beforeFn, proc, () => {\n          step(index + 1)\n        })\n      } else if (state === ERROR) {\n        runner(queue[index].afterFn, proc, () => {\n          step(index - 1)\n        })\n      } else {\n        runner(queue[index].afterFn, proc, () => {\n          step(index - 1)\n        })\n      }\n    }\n\n    step(0, proc)\n    return proc\n  }\n\n  run (initPayload, complete) {\n    return this.runQueue(initPayload, (hook, proc, next) => {\n      if (hook == null) return next()\n      try {\n        const input = proc._peek()\n        if (this.debug) {\n          let state = proc.state === Action.STATE.NORMAL ? 'PRE' : 'POST'\n          console.log(`***ACTION****-${state}-: ${this.name} --- input:`, input, ` --- locals: `, proc.locals)\n        }\n\n        let nextHook = (payload) => {\n          proc._push(payload)\n          if (payload instanceof Error) {\n            proc.setState(Action.STATE.ERROR)\n          }\n          next()\n        }\n\n        let args\n        if (proc.state === Action.STATE.ERROR || proc.state === Action.STATE.POST) {\n          args = input instanceof Error ? [input, null, proc, nextHook] : [null, input, proc, nextHook]\n        } else {\n          args = [input, proc, nextHook]\n        }\n\n        hook.apply(this.context, args)\n      } catch (any) {\n        proc._push(any instanceof Error ? any : new Error(any))\n        proc.setState(Action.STATE.ERROR)\n        next()\n      }\n    }, (proc) => {\n      typeof complete === 'function' && complete(proc)\n\n      if (this.debug) {\n        console.log(`****ACTION****: completed ${this.name} --- stack:`, proc.stack, ` --- locals: `, proc.locals)\n      }\n    })\n  }\n}\n\nAction.STATE = {\n  NORMAL: 1,\n  ERROR: 2,\n  ABORTED: 3,\n  POST: 4\n}\n\nAction.resolveHook = function (name, context) {\n  console.log('resolving: ', name)\n  if (context == null) {\n    return null\n  } else {\n    return (context.hooks && context.hooks[name]) ||\n      context[name]\n  }\n}\n\nAction.persistMethodWrapper = function (method, context) {\n  return function (payload, proc, next) {\n    return method.call(context, payload, proc, next)\n  }\n}","import { isPlainObject, warn } from './util.js'\nimport Action from './action.js'\n\nexport default function Plugin (options) {\n  return {\n    created () {\n      initActions(this, options)\n    }\n  }\n}\n\nfunction initActions (vm, options) {\n  const { actionPrefix, debug } = options\n  const actionsOptions = vm.$options.actions\n\n  if (!actionsOptions) return\n  let actions = []\n  if (Array.isArray(actionsOptions)) {\n    actionsOptions.forEach(value => {\n      if (typeof value === 'string') {\n        actions.push({\n          name: value,\n          action: makeAction(value, vm, debug)\n        })\n      } else if (isPlainObject(value)) {\n        const {name, action} = value\n        if (name == null || !(action instanceof Action)) {\n          warn(debug, `${value} is not a valid Action`)\n        }\n        actions.push(value)\n      }\n    })\n  }\n\n  if (actions.length) {\n    vm.__actions__ = actions\n    actions.forEach(({name, action}) => {\n      vm[actionPrefix + name] = (payload, complete) => {\n        return action.run(payload, complete)\n      }\n    })\n  }\n}\n\nfunction makeAction (name, context, debug) {\n  return new Action(name, context, debug)\n  // before<Name>, after<Name>\n  .define(name)\n  // before<NAME>, after<NAME>\n  .define(name.toUpperCase())\n  // name. call order: before<name> -> before<NAME> -> name -> after<Name> -> after<NAME>\n  .do(name)\n}\n","/**\n* 实现hooks机制\n*/\nimport Action from './action.js'\nimport Plugin from './plugin.js'\n\nlet Vue\n\nexport default function install (_Vue, options = {}) {\n  if (Vue) {\n    console.warn('vue-hooks already installed.')\n    return\n  }\n  if (options.persistMethodWrapper) {\n    Action.persistMethodWrapper = options.persistMethodWrapper\n  }\n\n  Action.resolveHook = function (name, context) {\n    if (context == null) {\n      return\n    } else {\n      return (context.$options && context.$options.hooks && context.$options.hooks[name]) ||\n        context[name]\n    }\n  }\n\n  Vue = _Vue\n  override(Vue, options)\n}\n\nfunction override (Vue, options) {\n  options = {\n    ...{\n      debug: Vue.config.debug,\n      actionPrefix: '$$'\n    },\n    options\n  }\n\n  /**\n  * hooks 选项合并策略\n  */\n  Vue.config.optionMergeStrategies.hooks = Vue.config.optionMergeStrategies.methods\n  Vue.mixin(Plugin(options))\n  Vue.Action = Action\n}\n\nexport {\n  Action\n}"],"names":["let","this","const"],"mappings":"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"}