!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o(t.VueHooks=t.VueHooks||{})}(this,function(t){"use strict";function o(t){return t.length>1?t.slice(0,1).toUpperCase()+t.slice(1):t}function e(t,o){t&&(console.warn(o),console.trace&&console.trace())}function n(t){var o=!1;if(null!=t&&"function"!=typeof t.toString)try{o=!!(t+"")}catch(t){}return o}function r(t){return!!t&&"object"==typeof t}function i(t){if(!r(t)||y.call(t)!==p||n(t))return!1;var o=v(t);if(null===o)return!0;var e=o.constructor;return"function"==typeof e&&e instanceof e&&h.call(e)===d}function s(t){return{created:function(){c(this,t)}}}function c(t,o){var n=o.actionPrefix,r=o.debug,s=t.$options.actions;if(s){var c=[];Array.isArray(s)&&s.forEach(function(o){if("string"==typeof o)c.push({name:o,action:u(o,t,r)});else if(i(o)){var n=o.name,s=o.action;null!=n&&s instanceof O||e(r,o+" is not a valid Action"),c.push(o)}}),c.length&&(t.__actions__=c,c.forEach(function(o){var e=o.name,r=o.action;t[n+e]=function(t,o){return r.run(t,o)}}))}}function u(t,o,e){return new O(t,o,e).define(t).define(t.toUpperCase()).do(t)}function a(t,o){return void 0===o&&(o={}),b?void console.warn("vue-hooks already installed."):(o.persistMethodWrapper&&(O.persistMethodWrapper=o.persistMethodWrapper),O.resolveHook=function(t,o){return null==o?void 0:o.$options&&o.$options.hooks&&o.$options.hooks[t]||o[t]},b=t,void f(b,o))}function f(t,o){o=Object.assign({},{debug:t.config.debug,actionPrefix:"$$"},{options:o}),t.config.optionMergeStrategies.hooks=t.config.optionMergeStrategies.methods,t.mixin(s(o)),t.Action=O}var p="[object Object]",l=Object.prototype,h=Function.prototype.toString,d=h.call(Object),y=l.toString,v=Object.getPrototypeOf,g=0,k=function(t){this.uid=g++,this.state=t,this.locals={},this.stack=[]};k.prototype.setState=function(t){return this.state=t,this},k.prototype.getState=function(){return this.state},k.prototype._push=function(t){return this.stack.push(t),this},k.prototype._pop=function(){return this.stack.pop()},k.prototype._peek=function(){return this.stack[this.stack.length-1]},k.prototype.set=function(t,o){return this.locals[t]=o,this},k.prototype.get=function(t){return this.locals[t]},k.prototype.destroy=function(){this.locals=null,this.stack=null};var O=function(t,o,e){return this.name=t,this.context=o,this.debug=e,this.hooks=[],this._beforeEachListener=[],this._afterEachListener=[],this};O.prototype.define=function(t,e){var n,r;if("string"==typeof t&&void 0===e){var i=o(t);n=O.resolveHook("before"+i,this.context),r=O.resolveHook("after"+i,this.context)}else n="function"==typeof t&&t||"string"==typeof t&&O.resolveHook(t,this.context),r="function"==typeof e&&e||"string"==typeof e&&O.resolveHook(e,this.context);return this.hooks.push({beforeFn:n,afterFn:r}),this},O.prototype.do=function(t){var o="function"==typeof t&&t||this.context[t];return this.persistMethod=O.persistMethodWrapper(o,this.context),this},O.prototype.runQueue=function(t,o,e){var n=this,r=this.hooks,i=O.STATE,s=i.NORMAL,c=i.ERROR,u=i.ABORTED,a=i.POST,f=s,p=new k(s);if(p._push(t),0===r.length)return l();var l=function(){e(p),p.destroy()},h=function(t){var e=p.getState();return t<0?l():f===s&&e===s&&t>=r.length?o(n.persistMethod,p,function(){f=a,p.setState(a),h(r.length-1)}):e===u?(f=u,l()):(e===c&&f===s&&(f=c,t-=1),void(f===s?o(r[t].beforeFn,p,function(){h(t+1)}):f===c?o(r[t].afterFn,p,function(){h(t-1)}):o(r[t].afterFn,p,function(){h(t-1)})))};return h(0,p),p},O.prototype.run=function(t,o){var e=this,n=O.STATE,r=n.NORMAL,i=n.ABORTED,s=n.POST,c=n.ERROR;return this.runQueue(t,function(t,o,n){if(null==t)return n();try{var u=o._peek();if(e.debug){var a=o.state===r?"PRE":"POST";console.log("***ACTION****-"+a+"-: "+e.name+" --- input:",u," --- locals: ",o.locals)}var f=function(t){o._push(t),t instanceof Error&&o.setState(c),n()};f.abort=function(){o.setState(i),n()};var p;p=o.state===c||o.state===s?u instanceof Error?[u,null,o,f]:[null,u,o,f]:[u,o,f],t.apply(e.context,p)}catch(t){o._push(t instanceof Error?t:new Error(t)),o.setState(c),n()}},function(t){"function"==typeof o&&o(t),e.debug&&console.log("****ACTION****: completed "+e.name+" --- stack:",t.stack," --- locals: ",t.locals)})},O.STATE={NORMAL:1,ERROR:2,ABORTED:3,POST:4},O.resolveHook=function(t,o){return console.log("resolving: ",t),null==o?null:o.hooks&&o.hooks[t]||o[t]},O.persistMethodWrapper=function(t,o){return function(e,n,r){return t.call(o,e,n,r)}};var b;t.default=a,t.Action=O,Object.defineProperty(t,"__esModule",{value:!0})});